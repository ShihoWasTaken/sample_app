<div class="col-xs-12 col-xs-offset-0 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3" id="content">
	<h1>Statistiques du site</h1>
  <ul class="nav nav-pills nav-justified">
    <li class="active"><a data-toggle="pill" href="#boxplot">Box plot des films vus</a></li>
    <li><a data-toggle="pill" href="#barchart">Histogramme Lecteurs/Non Lecteurs</a></li>
    <li><a data-toggle="pill" href="#piechart">Répartition de l'envie de lire</a></li>
  </ul>

  <div class="tab-content col-lg-12">
    <div id="boxplot" class="col-lg-12 tab-pane fade in active">
      <script src="/highcharts/highcharts.js"></script>
      <script src="/highcharts/highcharts-more.js"></script>

      <div  class='hidden' id="cinema"><%= @cinemaArray %></div>
      <div  class='hidden' id="tv"><%= @TVArray %></div>
      <div  class='hidden' id="computer"><%= @computerArray %></div>
      <div  class='hidden' id="tablet"><%= @tabletArray %></div>

      <div id="container" style="height: 400px; margin: auto; min-width: 310px; max-width: 600px"></div>
    </div>
    <div id="barchart" class="col-lg-12 tab-pane fade">
      <div  class='hidden' id="lecteurs"><%= @lecteurs %></div>
      <div  class='hidden' id="non-lecteurs"><%= @nonLecteurs %></div>
      <div  id='chart_div'></div>
    </div>
    <div id="piechart" class="col-lg-12 tab-pane fade">
      <div id="chart_pie" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/loader.js"></script>

  <script type="text/javascript">
  $( document ).ready(function() {
    var lecteurs = parseInt($('#lecteurs').text());
    var nonLecteurs = parseInt($('#non-lecteurs').text());
    google.charts.load('43', {packages:['corechart']});
    google.charts.setOnLoadCallback(drawChart);
    function drawChart() {
      var data = google.visualization.arrayToDataTable([
        ['Element', 'Density', { role: 'style' }],
        ['Lecteurs', lecteurs, 'gold'],
        ['Non-lecteurs', nonLecteurs, 'color: #e5e4e2' ]
      ]);
      var options = {
        title: "Pourcentage des lecteurs/non-lecteurs parmi les utilisateurs",
        bar: {groupWidth: '50%'},
        legend: 'none',
        showValueLabels: true,
        width: 900,
        height: 500,
      };
      var chart_div = document.getElementById('chart_div');
      var chart = new google.visualization.ColumnChart(chart_div);
      // Wait for the chart to finish drawing before calling the getImageURI() method.
      google.visualization.events.addListener(chart, 'ready', function () {
        chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
      });
      chart.draw(data, options);
    }
  });
  </script>

<script type="text/javascript">
$(function () {
  var cinemaArray = $('#cinema').text();
  cinemaArray = $.parseJSON( '[' + cinemaArray + ']' );

  var TVArray = $('#tv').text();
  TVArray = $.parseJSON( '[' + TVArray + ']' );
  
  var computerArray = $('#computer').text();
  computerArray = $.parseJSON( '[' + computerArray + ']' );

  var tabletArray = $('#tablet').text();
  tabletArray = $.parseJSON( '[' + tabletArray + ']' );

 $('#container').highcharts({

        chart: {
            type: 'boxplot'
        },

        title: {
            text: 'Box plot des films vus en fonction du support'
        },
        credits: {
            enabled: false
        },

        legend: {
            enabled: false
        },

        xAxis: {
            categories: ['Cinéma', 'TV', 'Ordinateur', 'Tablette'],
            title: {
                text: 'Support de visionnage'
            }
        },

        yAxis: {
            title: {
                text: 'Nombre de films vus par semaine'
            }
        },

        series: [{
            name: 'Nombre de films vus par semaine',
            data: [
                cinemaArray,
                TVArray,
                computerArray,
                tabletArray
            ],
            tooltip: {
                headerFormat: '<em>Support de visionnage: {point.key}</em><br/>'
            }
        }]

    });



  $('a[data-toggle="pill"]').on('shown.bs.tab', function (e) {
    var target = $(e.target).attr("href") // activated tab
    if(target == '#piechart')
    {
      // Chart pie
      $('#chart_pie').highcharts({
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            title: {
                text: 'Répartition de l\'envie de lire davantage'
            },
            credits: {
                enabled: false
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                        style: {
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                        }
                    }
                }
            },
            series: [{
                name: 'Brands',
                colorByPoint: true,
                data: [{
                    name: 'Veulent lire plus',
                    y: <%= @aimeLire %>
                }, {
                    name: 'Ne veulent pas lire plus',
                    y: <%= @aimePasLire %>,
                    sliced: true,
                    selected: true
                }]
            }]
        });
    }
  });


});

</script>